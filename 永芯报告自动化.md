本文件用来规划和记录永芯的功能清单，以及实现的进度。这个清单并不是一开始就能完全确定好的，而是边开发，边设计，边完善的。
# 核心组件
- [x] <span style="color:red;">**决策树模型**</span>：基于QTreeView定制的用户输入组件，用来实现让用户创建适用于多种条件的参数和蓝图元件。用户使用右键菜单创建新的节点，每个节点下面包含True和False两个子节点。双击子节点可以编辑节点属性。子节点下可以继续无限添加节点。<V-2.00，2023-6-14>
- [x] <span style="color:red;">**模板视图**</span>：基于QTabWidget和QTableWidget定制的用户创建模板元素的输入版块，用户也可以在这个版块查看编辑的组件。table中没有包括一个添加行按钮和一个删除行按钮。用户也可以使用右键菜单添加行和删除行。table中的其他列由各个模板模块自己定制。<V-2.00，2023-6-14>
- [x] <span style="color:red;">**属性编辑器**</span>：基于Qt的多种按钮和下拉列表组件定制的实现让用户编辑需要插入到模板中的元素。<V-2.00，2023-6-14>
- [x] <span style="color:red;">**模板编码与解码**</span>：用户编辑好的模板需要以特定的数据结构存储到文件中，生成报告时，则需要将储存在文件中的数据解析出来。<V-2.00，2023-6-14>
- [x] <span style="color:red;">**TB数据解析**</span>：将用户编辑好的模板数据解析成为tb模块可以识别的数据结构。<V-2.00，2023-6-14>
- [ ] <span style="color:red;">**内置模板**</span>：段落、表格、蓝图均设内置模板，以减少用户编辑模板的工作量。用户加载内置模板后，可以在直接将内置模板修改为自己的模板，不会影响内置模板的源文件。内置模板跟用户模板存储在同一个文件中，内置模板名称为空字符串，配合不允许用户自定义的模板名称为空这一机制，使用户无法修改内置模板，从而保证内置模板的安全。初始化时不加载内置模板。

# 全局功能<V-2.01，2023-6-29>
- [x] <span style="color:red;">**后台运行**</span>：勾选此选项以后，创建报告的word程序将被隐藏到后台运行。
- [x] <span style="color:red;">**复制模板**</span>*：增加复制现有模板的功能，用户可以根据自己编制的模板，建立另外一个模板副本，方便快速建立多个不同版本的模板。
- [x] <span style="color:red;">**激活状态**</span>：点击激活模板，即可激活所有自定义板块的模板。因为可能存在多个模板，只有被激活的模板才会在生成报告时被使用。已经激活的模板会在全局设置界面显示。
- [x] <span style="color:red;">**保存模板**</span>：保存按钮可以一次性所有自定义板块的模板。
- [x] <span style="color:red;">**导出模板**</span>：导出模板可以导出所有模板，也可以选择导出某些模板。只有已经保存的模板才能被导出。导出模板会将永芯Worksapce中的info.xlsx、TB模板以及程序内保存的段落、表格、蓝图模板五个文件打包成一个zip文件，生成在桌面永芯Workspace文件夹里。
- [x] <span style="color:red;">**加载模板**</span>：现在用户可以加载由永芯导出模板功能导出的zip模板文件。zip无需对zip模板文件进行解压。**`注意`**：如果本地已经保存的模板与加载的模板名称重复，会覆盖本地模板，包括本地设置的高级参数、info文件、TB模板。比如本地有一个名为“公募”的模板，加载了一个名为“公募”的模板，那么本地的“公募”模板会被覆盖。本地的info文件和TB模板会被加载模板里的info和TB模板覆盖。这样做的原因是段落、表格、蓝图模板会使用info文件的字段和TB模板中的表格名称作为参数，如果不覆盖，会可能会导致参数缺失，无法使用。在保证参数齐全的情况下，用户可以再替换回自己的info文件和TB模板。
- 以上复制、保存、加载、导出模板都是段落、表格、蓝图模板三合一配套操作的。

# 自定义参数模块
- [x] 加载info中的参数和TB中的参数，TB中的参数依靠填充颜色来识别（深灰色），颜色代码为RGB（123,123,123），颜色填充只能使用标准色或自定义颜色，不能只用主题颜色。同一个科目标题下，若有两个单元格填充深灰色，则自动创建“科目名称+上年”、“科目名称+本年”两个参数。只有一个填充则只创建本年参数。<V-2.00，2023-6-14>
- [x] 使用决策树，允许用户使用现有参数创建新的参数。<V-2.00，2023-6-14>
- [x] 将参数保存到文件中，方便下次使用。<V-2.00，2023-6-14>
- [x] 初次生成运行时和，将更新后参数发送到其他模块。<V-2.00，2023-6-14>
- [x] 参数修改后，点击`保存设置`按钮，将修改后的参数发送到自定义段落和自定义蓝图模块。这两个模块接受到新的参数以后，更新参数的显示。<V-2.01，2023-6-29>

# 自定义段落模块
- [x] <span style="color:red;">**单行查看**</span>：用户点击模板中的某行时，在左侧各个属性编辑框中显示该行的模块内容。自定义表格和自定义蓝图模块同样增加此功能。<V-2.01，2023-6-29>
- [x] <span style="color:red;">**单行修改**</span>：用户点击某行后，可以在属性编辑框中修改该行的属性设置值，点击`修改段落`按钮，即可用新的设置值替代原有的。自定义表格和自定义蓝图模块同样增加此功能。<V-2.01，2023-6-29>
- [x] <span style="color:red;">**模板同步**</span>：始终控制蓝图模板、段落模板和表格模板一一对应的关系。在这三个自定义模板集的任意一个中增加模板、删除模板、修改名称，都会在其他两个模板集中对应位置自动增加模板、删除模板、修改名称。<V-2.01，2023-6-29>
- [x] <span style="color:red;">**段落格式**</span>：允许用户自定义段落格式，比如字体、字号、对齐方式、加粗等，保存在段落模板中。<V-2.00，2023-6-14>
- [ ] 用户修改模板名称时，增加不允许名称为空值和重复值的验证。
- [x] 将用户输入的段落格式直接转化为可以储存的数据结构，而不是在调用时再次使用散列值表转化。<V-2.00，2023-6-14>
- [x] 制表位的定制，用户可以在段落中插入制表位，制表位的位置可以在段落模板中定制。<V-2.00，2023-6-14>
- [ ] 段落模板导出到excel，方便检查和比对模板的差异。
- [ ] 增加段落格式设置时，输入格式的限制。比如有些格式只能输入数字，不能输入文字或字母。防止输入错误格式导致程序崩溃。
- [x] 标题根据标题等级自动编号，比如“1.1”、“1.2”、“2.2.1”、“1.2.2”等。<V-2.00，2023-6-14>
- [x] 添加不纳入自动编号的标题，比如“目录”、“审计报告”、“年度财务报表”、“报表附注”等。<V-2.00，2023-6-14>
- [ ] 用户可以自定义自动编号的起始值，比如公募报告从“7”开始编号。
- [ ] 自动目录的生成，根据标题等级和标题内容生成带超链接的目录。
- [ ] 允许用户自定义页眉页脚，自定义页码的起始页和页码的样式。
- [ ] 将中文版式的设置改为自定义。
- [ ] 支持使用Delete按键删除某段选中的段落。
- [ ] 点击"添加段落"按钮以后，添加完毕自动清空编辑框中的内容。

# 自定义表格模块
- [x] 用户通过自定义TB模板实现自定义表格的绝大部分内容。在永芯的表格自定义模块，暂时只提供给用户自定义表格边框、列宽、字体、字号、负数形式这几项权限。TB模板不同于实际的TB，TB模板是所有实际产品TB的并集。用户从TB模板中挑选一部分表格，并逐个设置边框、列宽、字体等内容，组成一个表格模板。<V-2.00，2023-6-14>
- [x] 列宽的设置以百分别的形式，可以只设置部分列的列宽，剩余没有设置列宽的列，会平分剩余宽度。负数形式是指负号使用`-`还是`()`。<V-2.01，2023-6-29>
- [ ] 列宽设置限制只能是（0，100）区间的两个数字，并且合计不能超过100。用户每输入两个数字自动添加分隔符。
- [ ] 内置一个以科目名称为序列的`建议列宽的清单`，当用户设置某个科目的表格是，永芯自动查找并填写建议列宽，用户可在建议列宽的基础上对列宽进行微调。
- [x] 点击某一行已经插入的表格格式，会在左侧的编辑器中显示改行的属性。<V-2.01，2023-6-29>
- [x] 识别TB的数据对齐方式、下划线、加粗、斜体、合并单元格位置等，以特定数据结构存储到文件中。<V-2.00，2023-6-14>
- [ ] 自定义表格边线与表格内容的距离（即word中的审阅-标尺功能）。
- [x] 自定义签署区事务所、签字注会。<V-2.01，2023-6-29>
- [ ] 报表主表中的附注索引：用户输入一个需要添加索引的附注标题清单，永芯自动根据附注披露情况添加索引。

# 自定义蓝图模块
- [x] 用户自定义蓝图：自定义蓝图分两种元素，即固定元素和浮动元素。固定元素是没有条件限制，必然要添加的元素，比如审计意见的各个段落，只是基金名称和日期不同，其他的表述都一样。浮动元素是有条件限制的元素，比如附注下衍生金融资产/负债标题下，有有可能出现的是一个表格，有可能出现的是一段话。那么这个位置就是一个浮动元素。<V-2.00，2023-6-14>
- [x] 蓝图下表格名称的下拉列表清单自动从TB标题读取。所有标题必须填充浅蓝色，颜色代码RGB(0, 176, 240).<V-2.00，2023-6-14>
- [X] 段落名称下拉列表清单来自于用户在段落模板中设置的段落名称，因此要将对应蓝图模板名称与段落模板名称对应起来。<V-2.00，2023-6-14>
- [ ] 统一浮动元素设置比较值时的数据类型。设置参数值时，下拉列表清单同样自动关联到TB和段落模板。
- [ ] 增加一个可勾选的选项，自动在插入蓝图元素前插入空白行。
- [ ] 增加按元素类别、元素名称的筛选功能，方便快速定位到已经添加的蓝图元素。
- [x] 将添加和删除元素的按钮从视图中删除，放置到左侧编辑器下面，默认删除最后一行或在最后一行后面添加行。当鼠标悬停在视图某行时，右键点击添加按钮，即可在该行的下一行插入新行或者删除该行。<V-2.00，2023-6-14>

# 报告生成器
- [x] 读取设置好的段落模板，生成特定名称的段落，将段落中的参数名替换为参数值，设置段落格式、标题编号。<V-2.00，2023-6-14>
- [x] 生成特定科目名称的表格，复刻TB表格的合并单元格和对齐方式，设置表格宽度、表格边框，填充表格数据，并将其添加到正在编辑的word文档的末尾，生成表格后默认插入一个回车。<V-2.00，2023-6-14>
- [x] 根据TB中的数据填写表格数据，提供四种可识别的数据格式：常规型、数值型(小数位数可以任意设置)、文本型、百分比。<V-2.00，2023-6-14>
- [ ] 每个表格的对齐方式另外再提供给用户设置窗口，用于设置特定行、列或特定单元格的对齐方式。或者勾选默认设置：首列中部左对齐，其余列下部右对齐。
- [ ] 当用户没有编辑模板或者没有激活模板时，自动使用内置模板生成报告。
- [ ] 增加报告页面属性设置，比如页面大小、页边距、页眉页脚等。
- [x] 根据用户当前设定的参数和激活的蓝图，生成特定产品的蓝图。<V-2.00，2023-6-14>
- [x] 报告生成过程的可视化。<V-2.00，2023-6-14>
- [ ] 报告名称命名规则自定义

# 智能Compare
- [ ] 模拟实现word中的审阅-比较功能，比较两个word文档的差异，并将差异以批注的显示出来。
- [ ] 以单独列表的形式汇总差异。
- [ ] 生成报告的casting,将差异以列表的的形式汇总显示出来。

